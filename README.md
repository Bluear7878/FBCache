# Nunchaku FB-Cache Experiment

This repository contains an experiment demonstrating the **First-Block Cache (FBCache)** applied to a FluxPipeline with a quantized model on an **NVIDIA A5000** GPU. By adjusting the `residual_diff_threshold` parameter, we can see how caching affects subsequent inference times.

<br>

## Results
| Threshold | Case1 Inference (s) | Case2 Inference (s) | Case3 Inference (s) | Case4 Inference (s) | Case1 Image                                                                                   | Case2 Image                                                                                                   | Case3 Image                                                                                        | Case4 Image                                                                                                     |
|-----------|---------------------|---------------------|---------------------|---------------------|------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| 0         | 26.95              | 26.87              | 26.96              | 26.99              | <img src="./results/fb_cache_results/flux_t0_first.png" alt="case1_t0" width="140">           | <img src="./results/Dfb_cache_results_single_fixed/flux_t0_second.png" alt="case2_t0" width="140">           | <img src="./results/Dfb_cache_results_multi/flux_t0_second.png" alt="case3_t0" width="140">       | <img src="./results/Dfb_cache_results_dual/flux_t0_second.png" alt="case4_t0" width="140">                     |
| **Image** | *(동일행 강조용)*   | *(동일행 강조용)*   | *(동일행 강조용)*   | *(동일행 강조용)*   | *(위 셀에 이미 삽입됨)*                                                                        | *(위 셀에 이미 삽입됨)*                                                                                       | *(위 셀에 이미 삽입됨)*                                                                            | *(위 셀에 이미 삽입됨)*                                                                                          |

| 0.2       | 6.75               | 27.17             | 20.49             | 7.14              | <img src="./results/fb_cache_results/flux_t20.0_first.png" alt="case1_t0.2" width="140">       | <img src="./results/Dfb_cache_results_single_fixed/flux_t20.0_second.png" alt="case2_t0.2" width="140">      | <img src="./results/Dfb_cache_results_multi/flux_t20.0_second.png" alt="case3_t0.2" width="140">  | <img src="./results/Dfb_cache_results_dual/flux_t20.0_second.png" alt="case4_t0.2" width="140">                 |
| 0.4       | 4.11               | 16.85             | 19.65             | 4.55              | <img src="./results/fb_cache_results/flux_t20.0_first.png" alt="case1_t0.4" width="140">       | <img src="./results/Dfb_cache_results_single_fixed/flux_t40.0_second.png" alt="case2_t0.4" width="140">      | <img src="./results/Dfb_cache_results_multi/flux_t40.0_second.png" alt="case3_t0.4" width="140">  | <img src="./results/Dfb_cache_results_dual/flux_t40.0_second.png" alt="case4_t0.4" width="140">                 |
| 0.6       | 3.08               | 14.12             | 19.31             | 3.54              | <img src="./results/fb_cache_results/flux_t20.0_first.png" alt="case1_t0.6" width="140">       | <img src="./results/Dfb_cache_results_single_fixed/flux_t60.0_second.png" alt="case2_t0.6" width="140">      | <img src="./results/Dfb_cache_results_multi/flux_t60.0_second.png" alt="case3_t0.6" width="140">  | <img src="./results/Dfb_cache_results_dual/flux_t60.0_second.png" alt="case4_t0.6" width="140">                 |
| 0.8       | 2.56               | 12.39             | 19.14             | 3.04              | <img src="./results/fb_cache_results/flux_t20.0_first.png" alt="case1_t0.8" width="140">       | <img src="./results/Dfb_cache_results_single_fixed/flux_t80.0_second.png" alt="case2_t0.8" width="140">      | <img src="./results/Dfb_cache_results_multi/flux_t80.0_second.png" alt="case3_t0.8" width="140">  | <img src="./results/Dfb_cache_results_dual/flux_t80.0_second.png" alt="case4_t0.8" width="140">                 |
| 1         | 2.62               | 11.70             | 18.97             | 3.03              | <img src="./results/fb_cache_results/flux_t20.0_first.png" alt="case1_t1.0" width="140">       | <img src="./results/Dfb_cache_results_single_fixed/flux_t100.0_second.png" alt="case2_t1.0" width="140">     | <img src="./results/Dfb_cache_results_multi/flux_t100.0_second.png" alt="case3_t1.0" width="140"> | <img src="./results/Dfb_cache_results_dual/flux_t100.0_second.png" alt="case4_t1.0" width="140">                |

   |


| Threshold | Single_layer 0.4 고정 (s) | Multi_layer 0.4 고정 (s) | Single_layer Image                                                                                   | Multi_layer Image                                                                                          |
|-----------|---------------------------|--------------------------|-------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| 0.2       | 7.06                      | 6.54                     | <img src="./results/Dfb_cache_results_sing_fix_multi_var/flux_t20.0_second.png" alt="sing_0.2" width="140"> | <img src="./results/Dfb_cache_results/flux_t20.0_second.png" alt="multi_0.2" width="140">                |
| 0.4       | 4.5                       | 4.49                     | <img src="./results/Dfb_cache_results_sing_fix_multi_var/flux_t40.0_second.png" alt="sing_0.4" width="140"> | <img src="./results/Dfb_cache_results/flux_t40.0_second.png" alt="multi_0.4" width="140">                 |
| 0.6       | 4.17                      | 4.52                     | <img src="./results/Dfb_cache_results_sing_fix_multi_var/flux_t60.0_second.png" alt="sing_0.6" width="140"> | <img src="./results/Dfb_cache_results/flux_t60.0_second.png" alt="multi_0.6" width="140">                 |
| 0.8       | 3.69                      | 4.2                      | <img src="./results/Dfb_cache_results_sing_fix_multi_var/flux_t80.0_second.png" alt="sing_0.8" width="140"> | <img src="./results/Dfb_cache_results/flux_t80.0_second.png" alt="multi_0.8" width="140">                 |
| 1         | 3.7                       | 3.88                     | <img src="./results/Dfb_cache_results_sing_fix_multi_var/flux_t100.0_second.png" alt="sing_1.0" width="140">| <img src="./results/Dfb_cache_results/flux_t100.0_second.png" alt="multi_1.0" width="140">                |
